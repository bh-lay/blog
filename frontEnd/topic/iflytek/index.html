<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
    <title>Hidrupalï¼šæ°´æ»´ä»¬ï¼Œæˆ‘æƒ³é‡‡è®¿ä½ </title>
    <link rel="stylesheet" href="style.less">
</head>
<body>
<div id="app">
    <div class="chat-window" ref="chat-window">  
      <div class="chat-list" ref="chat-list" :style="{transform: 'translateY(' + -scrollTop + 'px)'}">
        <div v-for="chatItem in chatList" class="chat-item">
            <div :class="[chatItem.from === 'me' ? 'chat-item-me' : 'chat-item-other']">
                <span class="avatar" :style="{backgroundImage: 'url(' + user[chatItem.from].avatar + ')'}"></span>
                <div class="content">
                    <div class="nickname">{{user[chatItem.from].nickname}}</div>
                    <div class="content-body">
                      <div v-if="chatItem.text" class="text">{{chatItem.text}}</div>
                      <div v-else class="image" :style="{backgroundImage: 'url(' + chatItem.image + ')'}">
                        <div :style="{paddingTop: chatItem.sizePercent * 100 + '%'}"></div>
                      </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>
</div>
<script src="vue.js" type="text/javascript"></script>
<script type="text/javascript">
  var chatList = [
    {
      from: 'a',
      text: 'æ–°äººå¿«è‡ªæˆ‘ä»‹ç»'
    },
    {
      from: 'me',
      text: 'å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å‰§ä¸­äººï¼Œåœ¨å¤§æ•°æ®å†™é¡µé¢çš„'
    },
    {
      from: 'me',
      text: 'å‰å‡ å¤©ä¸€ä¸å°å¿ƒåˆ·äº†å¤§å®¶æœ‹å‹åœˆçš„ã€Œä¸­å›½å£°è°·çœ‹é›ªæ™¯ã€æ˜¯æˆ‘çš„ä½œå“'
    },
    {
      from: 'b',
      text: 'åŽŸæ¥æ˜¯ä½ å•Šï¼Œå¹¸ä¼šå¹¸ä¼š'
    },
    {
      from: 'c',
      text: 'ä½œå“æŒºç¾Žçš„ï¼ŒèµžðŸ‘'
    },
    {
      from: 'a',
      text: 'è¿›ç¾¤æœ‰å•¥äº‹ï¼Ÿ'
    },
    {
      from: 'me',
      text: 'æœ€è¿‘å…¬å¸ä¸æ˜¯æžäº†ä¸ªâ€œå…‰å½±éšå¿ƒâ€æ‘„å½±æ¯”èµ›ä¹ˆï¼Œæˆ‘ä¹ŸæŠ¥åå‚åŠ äº†'
    },
    {
      from: 'b',
      text: 'æ‡‚äº†ï¼Œä½ æ˜¯æ¥æ‰¾æˆ‘ä»¬åˆ·ç¥¨çš„'
    },
    {
      from: 'c',
      // text: 'å…ˆåˆ«åŠ¨ï¼Œçœ‹çœ‹ä»–æŽ¥ä¸‹æ¥è¯´ä»€ä¹ˆ',
      image: __uri('chat-image/despacito.png'),
      sizePercent: 1
    },
    {
      from: 'me',
      text: 'åˆ·ç¥¨å¯ä¸æ•¢ï¼Œä¼šè¢«å…¬å¸å¼€é™¤çš„'
    },
    {
      from: 'me',
      text: 'å°±æ˜¯æ´»åŠ¨å¤ªè¿‡çƒ­é—¹ï¼Œä½œå“å¤šåˆ°çˆ†ï¼Œæƒ³è®©å¤§å®¶æŠ½ç©ºçœ‹ä¸€ä¸‹æˆ‘çš„ä½œå“\nè§‰å¾—ä¸é”™çš„è¯éº»çƒ¦æŠ•æˆ‘ä¸€ç¥¨'
    },
    {
      from: 'b',
      text: 'è¿˜è¯´ä¸æ˜¯åˆ·ç¥¨çš„'
    },
    {
      from: 'c',
      // text: 'å°±æ˜¯å°±æ˜¯'
      image: __uri('chat-image/yes.jpg'),
      sizePercent: 1
    },
    {
      from: 'a',
      text: 'çœ‹æ¥ä½ æŒºç”¨å¿ƒçš„ï¼Œè¯´å§è¦æ€Žä¹ˆæŠ•ç¥¨ï¼Ÿ'
    },
    {
      from: 'me',
      text: 'å¤šè°¢å•¦ï¼Œæˆ‘çš„ä½œå“ä¸€å…±æœ‰ä¸¤ä»½,ä¸€ä»½æ˜¯ã€Œä¸­å›½å£°è°·çœ‹é›ªæ™¯ã€åŒåä½œå“ï¼Œå¦ä¸€ä»½æ˜¯ã€Œæ—…è¡Œéšæ‹ã€ï¼Œå°é¢å›¾æ˜¯'
    },
    {
      from: 'me',
      image: __uri('chat-image/screenshot.jpg'),
      sizePercent: .5
    },
    {
      from: 'me',
      text: 'æŠ•ç¥¨å°±æ˜¯ç‚¹èµžå•¦ï¼Œæ¯ä¸ªäººæœ‰åä¸ªç‚¹èµžçš„æœºä¼šï¼Œå‰©ä½™çš„èµžå¯ä»¥æ”¯æŒä¸‹å…¶ä»–å°ä¼™ä¼´çš„ä½œå“å‘¦ã€‚'
    },
    {
      from: 'c',
      text: 'æ´»åŠ¨åœ°å€åœ¨å“ªå„¿å‘¢ï¼Ÿ'
    },
    {
      from: 'me',
      text: 'å“¦ï¼Œå¿˜äº†å‘äº†ï¼Œå¯ä»¥ç‚¹è¿™ä¸ªé“¾æŽ¥ï¼Œå°±å¯ä»¥è¿›å…¥æŠ•ç¥¨é¡µé¢å•¦ï¼'
    },
  ];
  var user = {
      me: {
        nickname: 'å‰§ä¸­äººï¼ˆæ–°æˆå‘˜ï¼‰',
        avatar: __uri('avatar/avatar-lay.jpg')
      },
      a: {
        nickname: 'æµ…å°è¾„æ­¢ï¼ˆç¾¤ä¸»ï¼‰',
        avatar: __uri('avatar/a.jpg')
      },
      b: {
        nickname: 'æ ‘ä¸Šçš„éª·é«…ï¼ˆç‹—ç®¡ç†ï¼‰',
        avatar: __uri('avatar/b.jpeg')
      },
      c: {
        nickname: 'ä¸€é¡µï¼ˆèŒæ–°æ‹…å½“ï¼‰',
        avatar: __uri('avatar/c.jpg')
      }
  };
  function typed(text, stepCallback, onEnd){
    var sliceLength = 0;
    function step(){
      sliceLength++;
      callback(text.slice(0, sliceLength))
      if (sliceLength >= text.length) {
        onEnd();
      } else{
        setTimeout(step, 200)
      }
    }

  }
  new Vue({
    el: '#app',
    data: {
      scrollTop: 0,
      user: user,
      chatList: []
    },
    mounted: function () {
      var me = this;
      var nodeOuter = me.$refs['chat-window'];
      var nodeInner = me.$refs['chat-list'];
      function chatRobot(){
        if(chatList.length){
          me.chatList.push(chatList.shift());
          me.$nextTick(function(){
            if (nodeOuter) {
              me.scrollTop = Math.max(nodeInner.clientHeight - nodeOuter.clientHeight, 0);
            }
            setTimeout(function(){
              chatRobot()
            }, 1500);
          });
        } else {
          nodeOuter.classList.add('normal-scroll')
          nodeOuter.scrollTop = nodeInner.clientHeight - nodeOuter.clientHeight;
        }
      }
      chatRobot();
    }
  })
</script>
</body>
</html>